{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>證券代號</th>\n",
       "      <th>證券名稱</th>\n",
       "      <th>成交股數</th>\n",
       "      <th>成交筆數</th>\n",
       "      <th>成交金額</th>\n",
       "      <th>開盤價</th>\n",
       "      <th>最高價</th>\n",
       "      <th>最低價</th>\n",
       "      <th>收盤價</th>\n",
       "      <th>漲跌(+/-)</th>\n",
       "      <th>漲跌價差</th>\n",
       "      <th>最後揭示買價</th>\n",
       "      <th>最後揭示買量</th>\n",
       "      <th>最後揭示賣價</th>\n",
       "      <th>最後揭示賣量</th>\n",
       "      <th>本益比</th>\n",
       "      <th>Unnamed: 16</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>50.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4251739</td>\n",
       "      <td>1176</td>\n",
       "      <td>359040915</td>\n",
       "      <td>84.40</td>\n",
       "      <td>85.00</td>\n",
       "      <td>84.15</td>\n",
       "      <td>84.65</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.10</td>\n",
       "      <td>84.60</td>\n",
       "      <td>21</td>\n",
       "      <td>84.65</td>\n",
       "      <td>80</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>51.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>7500</td>\n",
       "      <td>3</td>\n",
       "      <td>243040</td>\n",
       "      <td>32.39</td>\n",
       "      <td>32.39</td>\n",
       "      <td>32.39</td>\n",
       "      <td>32.39</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.09</td>\n",
       "      <td>32.39</td>\n",
       "      <td>43</td>\n",
       "      <td>32.50</td>\n",
       "      <td>5</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>52.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>4001</td>\n",
       "      <td>5</td>\n",
       "      <td>229706</td>\n",
       "      <td>57.35</td>\n",
       "      <td>57.60</td>\n",
       "      <td>57.30</td>\n",
       "      <td>57.40</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.05</td>\n",
       "      <td>57.35</td>\n",
       "      <td>1</td>\n",
       "      <td>57.90</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>53.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>37</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.00</td>\n",
       "      <td>37.09</td>\n",
       "      <td>50</td>\n",
       "      <td>37.35</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>54.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2001</td>\n",
       "      <td>3</td>\n",
       "      <td>48904</td>\n",
       "      <td>24.44</td>\n",
       "      <td>24.44</td>\n",
       "      <td>24.44</td>\n",
       "      <td>24.44</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>0.05</td>\n",
       "      <td>24.41</td>\n",
       "      <td>50</td>\n",
       "      <td>24.64</td>\n",
       "      <td>8</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   證券代號  證券名稱     成交股數  成交筆數       成交金額    開盤價    最高價    最低價    收盤價  漲跌(+/-)  \\\n",
       "0  50.0   NaN  4251739  1176  359040915  84.40  85.00  84.15  84.65      1.0   \n",
       "1  51.0   NaN     7500     3     243040  32.39  32.39  32.39  32.39      1.0   \n",
       "2  52.0   NaN     4001     5     229706  57.35  57.60  57.30  57.40      1.0   \n",
       "3  53.0   NaN        1     1         37    NaN    NaN    NaN    NaN      NaN   \n",
       "4  54.0   NaN     2001     3      48904  24.44  24.44  24.44  24.44     -1.0   \n",
       "\n",
       "   漲跌價差  最後揭示買價  最後揭示買量  最後揭示賣價  最後揭示賣量  本益比  Unnamed: 16  \n",
       "0  0.10   84.60      21   84.65      80  0.0          NaN  \n",
       "1  0.09   32.39      43   32.50       5  0.0          NaN  \n",
       "2  0.05   57.35       1   57.90       1  0.0          NaN  \n",
       "3  0.00   37.09      50   37.35       1  0.0          NaN  \n",
       "4  0.05   24.41      50   24.64       8  0.0          NaN  "
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import requests\n",
    "from io import StringIO\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "\n",
    "datestr = '20180131'\n",
    "\n",
    "# 下載股價\n",
    "r = requests.post('https://www.twse.com.tw/exchangeReport/MI_INDEX?response=csv&date=' + datestr + '&type=ALL')\n",
    "\n",
    "# 整理資料，變成表格\n",
    "df = pd.read_csv(StringIO(r.text.replace(\"=\", \"\")), \n",
    "            header=[\"證券代號\" in l for l in r.text.split(\"\\n\")].index(True)-1)\n",
    "\n",
    "# 整理一些字串：\n",
    "df = df.apply(lambda s: pd.to_numeric(s.astype(str).str.replace(\",\", \"\").replace(\"+\", \"1\").replace(\"-\", \"-1\"), errors='coerce'))\n",
    "\n",
    "# 顯示出來\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "import requests\n",
    "site=\"https://query1.finance.yahoo.com/v8/finance/chart2303.Tw?period1=0&period2=1549258857&interval=1d&events=history&=hP2rOschxOO\"\n",
    "response=requests.get(site)\n",
    "print(response.text)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "import json\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "date =json.loads(response.text)\n",
    "df =pd.Dateframe(date['chart']['resuit'][0]['indicators']['quote'][0],index=pd.to_datetime(np.array(date['chart']['result'][0]['timestamp'])*1000*1000*1000))\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "import json\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "site=\"https://query1.finance.yahoo.com/v8/finance/chart2330.tw?period1=0&period2=1549258857&interval=1d&events=history&=hp2r0schx00\"\n",
    "date =json.loads(response.text)\n",
    "df =pd.Dateframe(date['chart']['resuit'][0]['indicators']['quote'][0],index=pd.to_datetime(np.array(date['chart']['result'][0]['timestamp'])*1000*1000*1000))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>072330</th>\n",
       "      <th>世紀鋼富邦05購01</th>\n",
       "      <th>3,165,000</th>\n",
       "      <th>43</th>\n",
       "      <th>4,638,020</th>\n",
       "      <th>1.44</th>\n",
       "      <th>1.47</th>\n",
       "      <th>1.42</th>\n",
       "      <th>1.46</th>\n",
       "      <th>-</th>\n",
       "      <th>0.12</th>\n",
       "      <th>1.45</th>\n",
       "      <th>40</th>\n",
       "      <th>1.46.1</th>\n",
       "      <th>30</th>\n",
       "      <th>92.20</th>\n",
       "      <th>Unnamed: 16</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>72331.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1314000</td>\n",
       "      <td>16</td>\n",
       "      <td>1481500</td>\n",
       "      <td>1.09</td>\n",
       "      <td>1.15</td>\n",
       "      <td>1.09</td>\n",
       "      <td>1.13</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>0.12</td>\n",
       "      <td>1.12</td>\n",
       "      <td>30</td>\n",
       "      <td>1.13</td>\n",
       "      <td>30</td>\n",
       "      <td>92.2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>72332.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>21000</td>\n",
       "      <td>2</td>\n",
       "      <td>19100</td>\n",
       "      <td>0.91</td>\n",
       "      <td>0.91</td>\n",
       "      <td>0.90</td>\n",
       "      <td>0.90</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>0.11</td>\n",
       "      <td>0.89</td>\n",
       "      <td>30</td>\n",
       "      <td>0.90</td>\n",
       "      <td>30</td>\n",
       "      <td>92.2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>72333.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>40000</td>\n",
       "      <td>2</td>\n",
       "      <td>27000</td>\n",
       "      <td>0.67</td>\n",
       "      <td>0.68</td>\n",
       "      <td>0.67</td>\n",
       "      <td>0.68</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>0.09</td>\n",
       "      <td>0.66</td>\n",
       "      <td>30</td>\n",
       "      <td>0.67</td>\n",
       "      <td>30</td>\n",
       "      <td>92.2</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>72334.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>422000</td>\n",
       "      <td>18</td>\n",
       "      <td>515100</td>\n",
       "      <td>1.10</td>\n",
       "      <td>1.26</td>\n",
       "      <td>1.10</td>\n",
       "      <td>1.26</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.07</td>\n",
       "      <td>1.20</td>\n",
       "      <td>30</td>\n",
       "      <td>1.21</td>\n",
       "      <td>30</td>\n",
       "      <td>98.3</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>72335.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>504000</td>\n",
       "      <td>19</td>\n",
       "      <td>673120</td>\n",
       "      <td>1.32</td>\n",
       "      <td>1.38</td>\n",
       "      <td>1.32</td>\n",
       "      <td>1.35</td>\n",
       "      <td>-1.0</td>\n",
       "      <td>0.05</td>\n",
       "      <td>1.34</td>\n",
       "      <td>30</td>\n",
       "      <td>1.35</td>\n",
       "      <td>30</td>\n",
       "      <td>82.6</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    072330  世紀鋼富邦05購01  3,165,000  43  4,638,020  1.44  1.47  1.42  1.46    -  \\\n",
       "0  72331.0         NaN    1314000  16    1481500  1.09  1.15  1.09  1.13 -1.0   \n",
       "1  72332.0         NaN      21000   2      19100  0.91  0.91  0.90  0.90 -1.0   \n",
       "2  72333.0         NaN      40000   2      27000  0.67  0.68  0.67  0.68 -1.0   \n",
       "3  72334.0         NaN     422000  18     515100  1.10  1.26  1.10  1.26  1.0   \n",
       "4  72335.0         NaN     504000  19     673120  1.32  1.38  1.32  1.35 -1.0   \n",
       "\n",
       "   0.12  1.45  40  1.46.1  30  92.20  Unnamed: 16  \n",
       "0  0.12  1.12  30    1.13  30   92.2          NaN  \n",
       "1  0.11  0.89  30    0.90  30   92.2          NaN  \n",
       "2  0.09  0.66  30    0.67  30   92.2          NaN  \n",
       "3  0.07  1.20  30    1.21  30   98.3          NaN  \n",
       "4  0.05  1.34  30    1.35  30   82.6          NaN  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import requests\n",
    "from io import StringIO\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "\n",
    "datestr = '20180131'\n",
    "\n",
    "# 下載股價\n",
    "r = requests.post('https://www.twse.com.tw/exchangeReport/MI_INDEX?response=csv&date=' + datestr + '&type=ALL')\n",
    "\n",
    "# 整理資料，變成表格\n",
    "df = pd.read_csv(StringIO(r.text.replace(\"=\", \"\")), \n",
    "            header=['2330' in l for l in r.text.split(\"\\n\")].index(True)-1)\n",
    "\n",
    "# 整理一些字串：\n",
    "df = df.apply(lambda s: pd.to_numeric(s.astype(str).str.replace(\",\", \"\").replace(\"+\", \"1\").replace(\"-\", \"-1\"), errors='coerce'))\n",
    "\n",
    "# 顯示出來\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
